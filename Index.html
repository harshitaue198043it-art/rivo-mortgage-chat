<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Rivo â€“ Buy vs Rent Guide (Prototype)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Basic styling -->
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f5f5f7;
      color: #111827;
      display: flex;
      justify-content: center;
      align-items: stretch;
      min-height: 100vh;
    }

    .app {
      background: #ffffff;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
      border-radius: 18px;
      margin: 16px;
      max-width: 480px;
      width: 100%;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .header {
      padding: 16px 18px;
      border-bottom: 1px solid #e5e7eb;
      background: linear-gradient(135deg, #eef2ff, #e0f2fe);
    }

    .header h1 {
      margin: 0;
      font-size: 18px;
      font-weight: 600;
      color: #111827;
    }

    .header p {
      margin: 4px 0 0;
      font-size: 13px;
      color: #4b5563;
    }

    .chat {
      flex: 1;
      padding: 16px;
      overflow-y: auto;
      background: #f9fafb;
    }

    .bubble {
      margin-bottom: 10px;
      padding: 10px 14px;
      border-radius: 16px;
      max-width: 80%;
      line-height: 1.4;
      white-space: pre-wrap; /* keep line breaks */
      font-size: 14px;
    }

    .bubble.bot {
      background: #ffffff;
      border: 1px solid #e5e7eb;
      align-self: flex-start;
    }

    .bubble.user {
      background: #2563eb;
      color: white;
      align-self: flex-end;
    }

    .meta {
      font-size: 11px;
      color: #6b7280;
      margin-bottom: 6px;
      align-self: center;
    }

    .input-bar {
      display: flex;
      padding: 10px;
      border-top: 1px solid #e5e7eb;
      background: #ffffff;
      gap: 8px;
    }

    .input-bar input {
      flex: 1;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      font-size: 14px;
      outline: none;
    }

    .input-bar input:focus {
      border-color: #2563eb;
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.1);
    }

    .input-bar button {
      padding: 8px 14px;
      border-radius: 999px;
      border: none;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      background: #2563eb;
      color: white;
      transition: background 0.15s ease;
    }

    .input-bar button:hover {
      background: #1d4ed8;
    }

    .tagline {
      font-size: 11px;
      color: #9ca3af;
      text-align: center;
      padding-bottom: 6px;
    }
  </style>
</head>
<body>
<div class="app">
  <div class="header">
    <h1>Rivo â€“ Buy vs Rent Coach</h1>
    <p>For UAE expat first-time buyers. Get a quick, personalised view.</p>
  </div>

  <div id="chat" class="chat"></div>
  <div class="tagline">Prototype only â€“ numbers are rough estimates, not financial advice.</div>

  <form id="form" class="input-bar">
    <input id="input" autocomplete="off" placeholder="Type your answer and press Enterâ€¦" />
    <button type="submit">Send</button>
  </form>
</div>

<!-- Logic -->
<script>
  const chat = document.getElementById('chat');
  const form = document.getElementById('form');
  const input = document.getElementById('input');

  // State of the conversation
  const state = {
    stage: 'intro',
    data: {}
  };

  /** Helper: add a message bubble to chat */
  function addMessage(text, from = 'bot') {
    const div = document.createElement('div');
    div.className = 'bubble ' + (from === 'bot' ? 'bot' : 'user');
    div.textContent = text;
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
  }

  /** (Optional) Helper: add tiny info text in middle */
  function addMeta(text) {
    const div = document.createElement('div');
    div.className = 'meta';
    div.textContent = text;
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
  }

  /**
   * MAIN LOGIC:
   * Decides what the bot says next given the last user message.
   * We use a simple state machine (stage-based).
   */
  function nextBotMessage(userText) {
    const d = state.data; // shortcut

    // Clean user input a bit
    const clean = userText.trim();

    // 1) INTRODUCTION
    if (state.stage === 'intro') {
      state.stage = 'reason';
      return "Hi, Iâ€™m Rivo ðŸ‘‹\nIâ€™ll walk you through a quick Buy vs Rent check for the UAE.\n\nFirst, whatâ€™s making you think about buying instead of continuing to rent?";
    }

    // 2) REASON FOR BUYING
    if (state.stage === 'reason') {
      d.reason = clean;
      state.stage = 'stay';
      return "Thanks for sharing that.\n\nRoughly how long do you see yourself staying in the UAE? (e.g. 2 years, 5, 10+)";
    }

    // 3) STAY DURATION
    if (state.stage === 'stay') {
      const yrs = parseInt(clean);
      d.stayYears = isNaN(yrs) ? 5 : yrs; // default 5 if unclear
      state.stage = 'income';
      return "Got it.\n\nTo keep the numbers realistic, whatâ€™s your approximate monthly income in AED? (You can give a range like 20,000 if you prefer.)";
    }

    // 4) INCOME
    if (state.stage === 'income') {
      d.income = parseFloat(clean) || 0;
      state.stage = 'rent';
      return "Thanks. Whatâ€™s your current monthly rent in AED?";
    }

    // 5) CURRENT RENT
    if (state.stage === 'rent') {
      d.rent = parseFloat(clean) || 0;
      state.stage = 'rentGrowth';
      return "Do you expect your rent to increase each year? If yes, roughly what % per year? (e.g. 3)";
    }

    // 6) RENT GROWTH
    if (state.stage === 'rentGrowth') {
      d.rentGrowth = parseFloat(clean) || 3; // default 3%
      state.stage = 'price';
      return "Okay.\n\nNow about the property youâ€™re considering: roughly whatâ€™s the price in AED?";
    }

    // 7) PROPERTY PRICE
    if (state.stage === 'price') {
      d.price = parseFloat(clean) || 0;
      state.stage = 'down';
      return "And how much can you put as a down payment in AED?";
    }

    // 8) DOWN PAYMENT
    if (state.stage === 'down') {
      d.down = parseFloat(clean) || 0;
      state.stage = 'rate';
      return "Last couple of things: what interest rate should we assume? (Just a guess, like 4.5)";
    }

    // 9) INTEREST RATE
    if (state.stage === 'rate') {
      d.rate = (parseFloat(clean) || 4) / 100; // convert to decimal
      state.stage = 'tenure';
      return "And over how many years would you like to repay the mortgage? (Common is 20â€“25)";
    }

    // 10) TENURE
    if (state.stage === 'tenure') {
      d.years = parseInt(clean) || 25;

      // Once tenure is received, we build summary and recommendation
      state.stage = 'summary';
      return buildSummaryAndRecommendation();
    }

    // 11) POST-SUMMARY SMALL TALK / NEXT STEP
    if (state.stage === 'summary') {
      state.stage = 'cta';
      return "If youâ€™d like, imagine this is connected to a real Rivo advisor â€“ this is where weâ€™d ask for contact details and give exact bank offers.\n\nFor this prototype, you can just reply with â€œokayâ€ or ask me to explain anything again.";
    }

    // 12) CTA / END
    if (state.stage === 'cta') {
      if (/^ok(ay)?$/i.test(clean)) {
        return "Nice! Thatâ€™s the full Buy vs Rent walkthrough. You can refresh the page to try different numbers anytime. ðŸ™Œ";
      } else {
        return "Got it. You can ask follow-up questions about any part of the summary, or refresh the page to start again with new numbers.";
      }
    }

    // Fallback
    return "Thanks for your message. You can refresh the page to start a fresh scenario if needed.";
  }

  /**
   * CALCULATION + EXPLANATION
   * Builds the summary and a simple recommendation string.
   */
  function buildSummaryAndRecommendation() {
    const d = state.data;

    const stayYears = d.stayYears || 5;
    const nMonthsStay = stayYears * 12;

    const monthlyRate = d.rate / 12;
    const loanAmount = Math.max(d.price - d.down, 0);

    // EMI formula (standard amortisation)
    let emi = 0;
    if (loanAmount > 0 && monthlyRate > 0) {
      const pow = Math.pow(1 + monthlyRate, d.years * 12);
      emi = (loanAmount * monthlyRate * pow) / (pow - 1);
    }

    // Total rent over stayYears with yearly increase
    let totalRent = 0;
    let rent = d.rent;
    for (let y = 0; y < stayYears; y++) {
      totalRent += rent * 12;
      rent *= (1 + d.rentGrowth / 100);
    }

    // Total EMI paid over stayYears (not full loan life)
    const totalEmiPaid = emi * nMonthsStay;

    // Simple affordability & recommendation logic
    const income = d.income || 0;
    const emiToIncome = income > 0 ? (emi / income) * 100 : null;

    let recParts = [];

    // Affordability comment
    if (emiToIncome !== null) {
      if (emiToIncome < 25) {
        recParts.push(`The estimated EMI is about ${emiToIncome.toFixed(1)}% of your monthly income, which is generally considered quite comfortable.`);
      } else if (emiToIncome <= 40) {
        recParts.push(`The estimated EMI is about ${emiToIncome.toFixed(1)}% of your monthly income. Thatâ€™s on the higher side of the usual comfort range, but could still work if your other expenses are moderate.`);
      } else {
        recParts.push(`The estimated EMI is about ${emiToIncome.toFixed(1)}% of your monthly income, which is high. Many people prefer to stay below ~35%.`);
      }
    }

    // Stay-horizon logic
    if (stayYears <= 3) {
      recParts.push("Because your expected stay in the UAE is relatively short, renting usually keeps things simpler and more flexible.");
    } else if (stayYears >= 7) {
      recParts.push("Since youâ€™re planning to stay long-term, buying can start to make more sense, as more of your payments go into building equity instead of pure rent.");
    } else {
      recParts.push("With a medium stay horizon, both buying and renting could work. The better option depends on how much you value flexibility vs. long-term stability.");
    }

    // Cost comparison logic
    if (totalEmiPaid && totalRent) {
      if (totalEmiPaid < totalRent * 0.9) {
        recParts.push("Based on these rough estimates, total mortgage payments over your planned stay are lower than what youâ€™d likely pay in rent, which strengthens the case for buying.");
      } else if (totalEmiPaid > totalRent * 1.1) {
        recParts.push("In this scenario youâ€™d likely pay more in mortgage EMIs over your stay than you would in rent, so youâ€™d only buy if you strongly value owning and potential long-term price growth.");
      } else {
        recParts.push("Your total payments for buying and renting are in a similar ballpark, so the decision is more about lifestyle, flexibility, and your comfort with risk.");
      }
    }

    // Build the friendly summary for the user
    return [
      "Hereâ€™s a quick summary based on what you shared:",
      "",
      `â€¢ Reason for buying: ${d.reason || "not specified"}`,
      `â€¢ Planned stay in UAE: ~${stayYears} years`,
      `â€¢ Approx. monthly income: ~${formatAED(d.income)} AED`,
      `â€¢ Current rent: ~${formatAED(d.rent)} AED / month`,
      `â€¢ Expected rent increase: ~${(d.rentGrowth || 3).toFixed(1)}% per year`,
      "",
      `â€¢ Property price considered: ~${formatAED(d.price)} AED`,
      `â€¢ Down payment: ~${formatAED(d.down)} AED`,
      `â€¢ Loan tenure: ${d.years} years`,
      `â€¢ Interest rate used (rough): ${(d.rate * 100).toFixed(2)}%`,
      "",
      `Estimated monthly EMI: ~${formatAED(emi)} AED`,
      "",
      `Over ~${stayYears} years, youâ€™d roughly pay:`,
      `â€¢ In rent (if you keep renting): ~${formatAED(totalRent)} AED`,
      `â€¢ In mortgage EMIs over that same period: ~${formatAED(totalEmiPaid)} AED`,
      "",
      "How this translates into a simple recommendation:",
      "",
      recParts.join(" ")
    ].join("\n");
  }

  /** Format numbers as AED-like strings */
  function formatAED(num) {
    num = Number(num) || 0;
    return num.toLocaleString('en-AE', { maximumFractionDigits: 0 });
  }

  // INITIAL BOT MESSAGE
addMessage("Hi, Iâ€™m Rivo ðŸ‘‹\nIâ€™ll walk you through a quick Buy vs Rent check for the UAE.\n\nFirst, whatâ€™s making you think about buying instead of continuing to rent?");
state.stage = "reason";

  
  // FORM HANDLER
  form.addEventListener('submit', function (e) {
    e.preventDefault();
    const text = input.value.trim();
    if (!text) return;

    // 1) Add user message
    addMessage(text, 'user');
    input.value = '';

    // 2) Get bot reply based on state + user message
    const reply = nextBotMessage(text);

    // 3) Add bot message
    if (reply) addMessage(reply, 'bot');
  });
</script>
</body>
</html>
